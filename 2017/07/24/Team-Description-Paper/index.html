<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>Team Description Paper | BISTU Sun@Home</title>
    <meta name="author" content="Sun@Home">
    
    <meta name="description" content="Team Website">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="Team Description Paper"/>
    <meta property="og:site_name" content="BISTU Sun@Home"/>

    
    <meta property="og:image" content=""/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="BISTU Sun@Home" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="indigo">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">BISTU Sun@Home</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            Home
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            Archives
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            Categories
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            About
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            Search
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav indigo darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="http://a3.qpic.cn/psb?/V10qjr6n1YNIvt/9jv7kvQsCKLHMtyGrVe4TQ8Vc5KUDf*xby4EG1e3RtQ!/b/dPIAAAAAAAAA&amp;ek=1&amp;kp=1&amp;pt=0&amp;bo=igCJAAAAAAARFyM!&amp;vuin=276840985&amp;tm=1504314000&amp;sce=60-2-2&amp;rf=viewer_4" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">Sun@Home</p>
                        <p class="desc">BISTU/Home Service Robot/Sun@Home</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    Home
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    Archives
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    Categories
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    About
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    Search
                </a>
            </li>
        
    </ul>

    <ul class="side-nav indigo darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Description/">
                    Description <span class="right">1</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Members/">
                    Members <span class="right">1</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">Search</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper indigo">
        <span class="breadcrumb">Current page(Categories)</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/Description/">Description</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>Team Description Paper</h1>
    


            </div>
            <time class="pink-link-context" datetime="2017-07-24T08:30:17.000Z"><a href="/2017/07/24/Team-Description-Paper/">2017-07-24</a></time>

            <span id="busuanzi_container_page_pv" class="read-times-container">
    <i class="fa fa-eye"></i>
    <span id="busuanzi_value_page_pv"></span>
</span>

            
    <div class="tags-row">
        
            <a href="/tags/Introduction/" class="chip pink lighten-1">Introduction</a>
        
    </div>


            <div class="toc pink-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#I-Introduction"><span class="section table-of-contents-text">I. Introduction</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#II-Robot-Platform"><span class="section table-of-contents-text">II. Robot Platform</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Mobile-Platform"><span class="section table-of-contents-text">Mobile Platform</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Lifting-Spine-Structure-amp-Manipulator"><span class="section table-of-contents-text">Lifting Spine Structure & Manipulator</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Sensors"><span class="section table-of-contents-text">Sensors</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#III-Software-System"><span class="section table-of-contents-text">III. Software System</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#SLAM"><span class="section table-of-contents-text">SLAM</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Path-Planning-Algorithm"><span class="section table-of-contents-text">Path Planning Algorithm</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Automatic-Charging-System"><span class="section table-of-contents-text">Automatic Charging System</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#IV-Vision-system"><span class="section table-of-contents-text">IV. Vision system</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#V-Manipulation"><span class="section table-of-contents-text">V. Manipulation</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#VI-Conclusion-and-future-work"><span class="section table-of-contents-text">VI. Conclusion and future work</span></a></li><li class="section table-of-contents-item section table-of-contents-level-1"><a class="section table-of-contents-link" href="#References"><span class="section table-of-contents-text">References</span></a></li></ol>
</div>


            <div class="entry pink-link-context">
                <p><img src="/2017/07/24/Team-Description-Paper/hao yadong.jpg" alt=""></p>
<p>The paper mainly introduces the robot hardware structure and the software system of Sun@Home. The robot platform is designed by Sun@Home’s own research and development, and the software system is build on both Windows OS and ROS.<br><a id="more"></a><br>The introductions of robot include details of robot hardware platform, vision system, SLAM and the robot path planning. Moreover, our main research efforts this year have focused on i) new robot platform hardware ii) automatic charging system: including a patented detection device on robot and an independent charging-point equipment and iii) developing a smartphone APP to provide the user with a platform independent way to interact with the robot.</p>
<h1 id="I-Introduction"><a href="#I-Introduction" class="headerlink" title="I. Introduction"></a>I. Introduction</h1><p>Sun@Home is the RoboCup team of Beijing Information Science and Technology University, funded by National Natural Science Foundation of China. Sun@Home has been competing in the @Home league since 2009, winning the 2016 and 2017 RoboCup China Open and finishing 14th at RoboCup 2015 in Hefei. Sun@Home consists of professors and master students of engineering and staff members from different departments within the Beijing Information Science and Technology University.<br>This Team Description Paper is part of the qualification package for RoboCup 2017 in Bangkok,Thailand and describes the current status of the @Home activities of Sun@Home. Sun@Home team builds on the navigation, object recognition and planning capabilities which we have developed as part of our previous efforts in middle size leagues. Sun@Home team also incorporate our recent research results on human tracking, face recognition, scene perception, methods to improve the perception of human behavior and interaction with humans using “natural” language and gesture modes of communication, etc. The following sections describe the key components of our team.</p>
<h1 id="II-Robot-Platform"><a href="#II-Robot-Platform" class="headerlink" title="II. Robot Platform"></a>II. Robot Platform</h1><p>The platforms are improved from our three wheel mobile platform, the hardware and software are redesigned according to the demands of RoboCup@Home league. Our platform consists of a heavy load three wheel mobile platform for moving, a lifting spine structure, a high precision 3-DOF manipulator designed for object grasping. A Microsoft Kinect 2 for windows cameras and a UTM-30LX laser scanner are selected as the sensors. The constructed service robot platform is depicted in Figure 1. The mobile platform size is 0.51m0.59m in length and width. The minimum height of our robot is 1.3m and its maximum height can reach 1.7m by driving the lift platform.<br><img src="/2017/07/24/Team-Description-Paper/hao yadong.jpg" alt=""></p>
<h2 id="Mobile-Platform"><a href="#Mobile-Platform" class="headerlink" title="Mobile Platform"></a>Mobile Platform</h2><p>The mobile platform is shown in the bottom of figure 1. The mobile base has three driven omni-wheels which are uniformly distributed on the base. Three industrial brushless servo motors are selected to drive the omni-wheels. A synchronous belt transmission is inserted to absorb the shock noise between the wheel and the ground. The designed entity relationship diagrams are shown in figure 2. Our design idea is that the service robot mobile platform should be conveniently moving in a domestic environment, and should be accurate, robust to the input commands. The reason is that reliable motion of the service robot is the backbone of almost all the robot’s behaviors.</p>
<h2 id="Lifting-Spine-Structure-amp-Manipulator"><a href="#Lifting-Spine-Structure-amp-Manipulator" class="headerlink" title="Lifting Spine Structure &amp; Manipulator"></a>Lifting Spine Structure &amp; Manipulator</h2><p>Object manipulation is a basic function of the domestic service robot, so the manipulator is necessary equipment for the robot. The 6D industry manipulator need complex inverse kinematics programming, and it is too heavy to apply for the domestic service robot. We design a new 3D manipulator which has a shoulder joint, an elbow joint and a wrist joint. The joints are driven by three Maxon brushless motors. Obviously, only using a 3D manipulator, the end-effector cannot reach the entire workspace. We design a drive system which can lift the shoulder joint to appropriate position in the vertical direction and the mobile base can locate the position and direction of the shoulder joint in horizontal plane. The designed entity relationship diagrams of the ball-screw lifting platform and the modular joint are shown in figure 3.</p>
<h2 id="Sensors"><a href="#Sensors" class="headerlink" title="Sensors"></a>Sensors</h2><p>We have used two sensors on the robot platform to perceive its environment:</p>
<ol>
<li>A Hokuyo UTM-30LX Laser Range finder has been placed on the mobile base for mapping, location, navigation and obstacle avoidance.</li>
<li>3D Ranging Camera: Microsoft Kinect V2 has been installed on the top of the robot platform for scene perception.<br>The positions of the sensors are shown on figure 1.</li>
</ol>
<h1 id="III-Software-System"><a href="#III-Software-System" class="headerlink" title="III. Software System"></a>III. Software System</h1><p>The software of our robot system is not only based on ROS but also designed by C++ based on the Microsoft VS2010. The control software architecture is shown in figure 4.</p>
<h2 id="SLAM"><a href="#SLAM" class="headerlink" title="SLAM"></a>SLAM</h2><p>The planar Slam module is shown in figure 5. Only the data of Laser Range finder is used in our Slam approach, and the odometry is not needed [1]. Scan matching is performed between two laser scans to determine the relative positions from which the scans were obtained. We have implemented the Real-Time Correlative Scan Matching algorithm proposed by Edwin B. Olson [2]. It is robust to initialization error and can find the global maximum of the cost function of scan match. The effect of this method is shown in figure 6, a comparison of the actual lobby environment of our lab to what is mapped by the robot is shown. The bright points represent free region, the black points represent occupy region, and the grey points represent unknown region. There are three tables in the lobby, and the footprints of the table’s legs are clear shown in the map. The map is the base of robot location and navigation.<br>We also built maps online with a Kinect. We choose two indoor environments due to<br>the limit of the depth range of Kinect. The 3D maps generated with our system is<br>shown in Figure 7.</p>
<h2 id="Path-Planning-Algorithm"><a href="#Path-Planning-Algorithm" class="headerlink" title="Path Planning Algorithm"></a>Path Planning Algorithm</h2><p>We present a path-planning algorithm for mobile robot platform based on Cellular Automata(CA) and artificial potential field, and the algorithm have been implemented by a 4-layer cellular automata model. Firstly, an expanded occupancy grid map is constructed so that the mobile robot can be simplified as a point in the planning algorithm. Secondly, a digital obstacles artificial potential field map is obtained to include the local influence of the obstacles. Then, a distance propagation map is generated by a CA model. Finally, the optimal collision-free path from start point to goal is extracted by following the minimum valley of the potential hyper-surface. The simulation result is shown as figure 8. The result shows that the optimal collision-free paths can be found by the proposed algorithm. The optimal paths are smooth enough and have larger safety distance from the obstacles. So the optimal paths are convenient to track by our mobile robot platform. Our navigation method can make our robot to track the optimal paths, and in the same time, perform local obstacle avoidance when there are moving objects.</p>
<h2 id="Automatic-Charging-System"><a href="#Automatic-Charging-System" class="headerlink" title="Automatic Charging System"></a>Automatic Charging System</h2><p>Consider for the robot using in real life, it’s challenging but necessary for such a heavy robot charging automatic. So we designed a system to finish this work. First of all, there should be a docking station fit the Sun@Home robot and supply power for charging. Secondly, docking station need to detect if the robot is in. Docking station need to start charging when the robot in it, otherwise close the circuit. Thirdly, robot need a structure at the bottom to form the charging circuit. At the same time, this structure should keep away from the floor when robot out of docking station, in order to avoid some dangerous situations.</p>
<h1 id="IV-Vision-system"><a href="#IV-Vision-system" class="headerlink" title="IV. Vision system"></a>IV. Vision system</h1><p>The vision module is developed to allow our robot to localize, to manipulate unknown objects in unstructured environments. The key problem in 2D camera is that the depth information is lost. So we use a Microsoft Kinect as vision sensor, it is very robust to large illumination change. The planes are first extracted from the 3D Point Clouds which are acquired from the unknown scene by Kinect [3]. We have implemented the planes segmented by surface normal’s clustering which is proposed by Dirk Holz in Bonn University, and had been verified on his RoboCup@Home platform [4]. The graspable objects in table top are segmented by projecting all points onto the planes they belong to. For the recognition of objects, we use combination of color, local features and the 3D shape information. Figure 9 shows the extracted table surface and graspable object by the vision system. The known object’s on the table are segmented and their names are shown on the top of the contain boxes. The unknown object’s on the table are also segmented and A symbol ‘??’ is labeled on the top of every unknown object’s. The graspable object’s pose can localized by our system, the position error is less than 1cm.</p>
<h1 id="V-Manipulation"><a href="#V-Manipulation" class="headerlink" title="V. Manipulation"></a>V. Manipulation</h1><p>Using the simplified arm described in section 2.2 and the proposed vision system in section 4, the robot platform can performs basic object manipulation tasks such as grasping objects from table top. Our robot first roughly localizes the shoulder joint to appropriate position by driving lifter in the vertical direction and the mobile base in horizontal plane, then the arm performs fine tuning to locate the end-effector at an appropriate position, and the end-effector is closed to grasp the object. The object is lifted up from the table top by the lifter, and then the robot moves to the target position by driving mobile base.</p>
<h1 id="VI-Conclusion-and-future-work"><a href="#VI-Conclusion-and-future-work" class="headerlink" title="VI. Conclusion and future work"></a>VI. Conclusion and future work</h1><p>In this paper, we have introduced our team Sun, and our robot platform for the RoboCup@Home 2017 competition. We have also introduced our robot’s ability to grasp unknown objects firmly, to perform SLAM, navigation, and object recognition. A new Manipulator will be made to perform grasp before the RoboCup@Home 2015 competition.</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol>
<li>Zhang Qizhi , Zhou yali ,A Hierarchical Iterative Closest Point Algorithm for Simultaneous Localization and Mapping of Mobile Robot, Proceedings of the 10th World Congress on Intelligent Control and Automation, Beijing, China, 2014.</li>
<li>Edwin B. Olson, Real-Time Correlative Scan Matching, 2009 IEEE International Conference on Robotics and Automation Kobe International Conference Center Kobe, Japan, May 12-17, 2009.</li>
<li>Zhang Qizhi, Zhou yali, Scene cognition for object grasping based on kinect, Journal of Beijing Information Science &amp; Technology University, 2016,27(5):11-16</li>
<li>Dirk Holz, Stefan Holzer, Radu Bogdan Rusu, and Sven Behnke, Real-Time Plane Segmentation using RGB-D Cameras, In Proceedings of the 15th RoboCup International Symposium, Istanbul, July 2011.</li>
</ol>

                
<p class="pink-link-context">
    <a href="/2017/08/04/Team-Members/" rel="next" title="Team Members">
    Prev: Team Members
  </a>
</p>




            </div>
			
        </div>
    </div>
</article>






</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large pink">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect green" title="Return to top"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse yellow darken-1"  data-activates="main-menu" title="Menu"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer indigo darken-1">
    
    <div class="footer-container container">
        <div class="row">
            
            <div class="social-group col m4 s12">
                <h5 class="white-text">Social</h5>
                
                    <a class="social-link" href="http://weibo.com/1956184117" target="_blank">
                        <i class="fa fa-2x fa-weibo"></i>
                    </a>
                
                    <a class="social-link" href="https://github.com/raytaylorlin" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
                
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
    <div class="site-visitors-container white-text">
        <span>
            <i class="fa fa-user"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
        </span>
        <span>&nbsp;|&nbsp;</span>
        <span>
            <i class="fa fa-eye"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
        </span>
    </div>


            </div>
            

            
            <div class="col m8 s12">
                <h5 class="white-text">Links</h5>
                
                    <a class="social-link" href="http://www.robocup.org" target="_blank">RoboCup Official HomePage</a>
                
                    <a class="social-link" href="http://www.robocupathome.org" target="_blank">RoboCup@Home Official HomePage</a>
                
                    <a class="social-link" href="https://robocup.rwth-aachen.de/athomewiki/index.php/Main_Page" target="_blank">RoboCup@Home Wiki</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright pink-link-context">
        <div class="container">
            © 2017 bistusunhome.info, All rights reserved.
            <p class="right" style="margin-top: 0;">Blog powered by <a href="https://hexo.io">Hexo</a> | Theme <a href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();

            // 目录随屏幕滚动（防止目录过长越过footer）
            var $toc = $('.toc');
            var scrollTargetTop = 0;
            $(window).scroll(function() {
                var $activeLink = $toc.find('a.active.section');
                if ($(window).scrollTop() < 100) {
                    scrollTargetTop = 0;
                } else {
                    if ($activeLink[0]) {
                        scrollTargetTop = $activeLink.offset().top - $toc.offset().top;
                    }
                }
                $toc.css('top', '-' + scrollTargetTop + 'px');
            });

            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('pink lighten-2');

            
            // 添加new标签
            $('.menu-about').append('<span class="new badge pink"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



</body>
</html>
